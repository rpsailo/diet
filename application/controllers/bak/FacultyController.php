<?phpclass FacultyController extends Zend_Controller_Action{	protected $userm;	protected $facultym;	protected $facultyf;	protected $facultytoolbarf;	public function init()	{		$this->_alert = $this->_helper->getHelper("FlashMessenger");		$this->userm = new Model_User();		$this->facultym = new Model_Faculty();        $this->facultyf = new Form_Faculty();        $this->facultytoolbarf = new Form_FacultyToolbar();	}		public function indexAction()	{		$this->_redirect('/faculty/list/');	}	public function addAction()	{	 	if($this->_request->isPost())        {        	if($this->facultyf->isValid($_POST))        	{        		// Create User	            $user_id = $this->userm->create($this->_request->getPost(), 'faculty');	            // Create Faculty	            $result = $this->facultym->create($this->_request->getPost(), $user_id);	            if($result)	            {	                $this->_alert->addMessage(array("message"=>'<i class="icon icon-ok"></i> New faculty added.', "status"=>"success"));	                $this->_redirect("/faculty/list/");	            }        	}        }		$this->view->form = $this->facultyf;	}		public function listAction()	{		$url_params = '';    	$search = $this->_request->getParam('search', null);    	$designation = $this->_request->getParam('designation', null);    	$page = $this->_request->getParam('page', 1);    	$params = array(    		'page'			=> $page,    		'condition'		=> array("`type` = 'faculty'"),    		'field'		=> array('id','username', 'type', 'loggedin_at'),    		'join_table'	=> 'faculty',    		'join_on'		=> 'user.id = faculty.user_id',    		'join_field'	=> array('faculty_id', 'faculty_name', 'faculty_designation')		);    	if($search != null)    	{    		$url_params .= '/search/'.$search;    		$params['condition'][] = "`faculty_name` LIKE '%".$search."%'";    		$this->facultytoolbarf->search->setValue($search);    	}    	if($designation != null && $designation != 0)    	{    		$url_params .= '/designation/'.$designation;    		$params['condition'][] = "`faculty_designation` LIKE '%".$designation."%'";    		$this->facultytoolbarf->designation->setValue($designation);    	}		if($this->_request->isPost())    		$this->_redirect('/faculty/list'.$url_params.'/page/'.$page);    	$this->view->data = $this->userm->paginate($params);    	$this->view->form = $this->facultytoolbarf;	}	public function deleteAction()	{		$id = $this->_request->getParam('id');		if($id)		{			$faculty = $this->facultym->find($id)->current();			if($faculty)			{				$faculty_name = $faculty->faculty_name;				$faculty_user_id = $faculty->user_id;								$faculty->delete();								$this->userm->delete('id = '.$faculty_user_id);				$this->_alert->addMessage(array("message"=>'<i class="icon icon-trash"></i> Faculty "'.$faculty_name.'" deleted.', "status"=>"success"));			}		}		else		{			$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Incorrect faculty ID.', "status"=>"error"));		}		$this->_redirect('/faculty/list/');	}	public function resetPasswordAction()	{		$id = $this->_request->getParam('id');		if($id)		{			$faculty = $this->facultym->find($id)->current();			$user = $this->userm->find($faculty->user_id)->current();						$this->facultyf->password->setLabel('New Password');			$this->facultyf->repeat_password->setLabel('Confirm New Password');			$this->facultyf->removeElement('username');			$this->facultyf->removeElement('faculty_name');			$this->facultyf->removeElement('faculty_designation');						if($user)			{			 	if($this->_request->isPost())		        {		        	if($this->facultyf->isValid($_POST))		        	{			            $result = $this->userm->change_password($this->_request->getParam('password'), $user->id);			            if($result)			            {			                $this->_alert->addMessage(array("message"=>'<i class="icon icon-ok"></i> Password reset succesful for faculty "'.$faculty->faculty_name.'".', "status"=>"success"));			                $this->_redirect("/faculty/list");			            }		        	}		        }								$this->view->form = $this->facultyf;				$this->view->user = $user;				$this->view->faculty = $faculty;			}			else			{				$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Invalid faculty ID.', "status"=>"error"));				$this->_redirect('/faculty/list/');			}		}		else		{			$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Incorrect faculty ID.', "status"=>"error"));			$this->_redirect('/faculty/list/');		}	}	public function editAction()	{		$id = $this->_request->getParam('id');		if($id)		{			$faculty = $this->facultym->find($id)->current();			$user = $this->userm->find($faculty->user_id)->current();						if($faculty)			{				$this->facultyf->removeElement('password');				$this->facultyf->removeElement('repeat_password');				$this->facultyf->username->setRequired(false)->setAttrib('disabled', 'disabled');			 	if($this->_request->isPost())		        {		        	if($this->facultyf->isValid($_POST))		        	{			            $result = $this->facultym->edit($this->_request->getPost(), $faculty->faculty_id);			            if($result)			            {			                $this->_alert->addMessage(array("message"=>'<i class="icon icon-ok"></i>  Faculty updated.', "status"=>"success"));			                $this->_redirect("/faculty/edit/id/".$faculty->faculty_id);			            }		        	}		        }		        else					$this->facultyf->populate($faculty->toArray());				$this->facultyf->populate($user->toArray());				$this->view->form = $this->facultyf;			}			else			{				$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Invalid faculty ID.', "status"=>"error"));				$this->_redirect('/faculty/list/');			}		}		else		{			$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Incorrect faculty ID.', "status"=>"error"));			$this->_redirect('/faculty/list/');		}	}}