<?phpclass CourseController extends Zend_Controller_Action{	protected $coursem;	protected $coursef;	protected $coursetoolbarf;	protected $examm;	protected $questionm;	protected $studentm;	protected $userm;	public function init()	{		$this->_alert = $this->_helper->getHelper("FlashMessenger");		$this->coursem = new Model_Course();        $this->coursef = new Form_Course();        $this->coursetoolbarf = new Form_CourseToolbar();		$this->examm = new Model_Exam();		$this->questionm = new Model_Question();		$this->studentm = new Model_Student();		$this->userm = new Model_User();	}		public function indexAction()	{		$this->_redirect('/course/list/');	}	public function addAction()	{	 	if($this->_request->isPost())        {        	if($this->coursef->isValid($_POST))        	{	            $result = $this->coursem->create($this->_request->getPost());	            if($result)	            {	                $this->_alert->addMessage(array("message"=>'<i class="icon icon-ok"></i> New course added.', "status"=>"success"));	                $this->_redirect("/course/list/");	            }        	}        }		$this->view->form = $this->coursef;	}		public function listAction()	{		$url_params = '';    	$search = $this->_request->getParam('search', null);    	$page = $this->_request->getParam('page', 1);    	$params = array(    		'page'		=> $page,    		'condition'	=> array()		);    	if($search != null)    	{    		$url_params .= '/search/'.$search;    		$params['condition'][] = "`course_name` LIKE '%".$search."%'";    		$this->coursetoolbarf->search->setValue($search);    	}		if($this->_request->isPost())    		$this->_redirect('/course/list'.$url_params.'/page/'.$page);    	$this->view->data = $this->coursem->paginate($params);    	$this->view->form = $this->coursetoolbarf;	}	public function deleteAction()	{		$id = $this->_request->getParam('id');		if($id)		{			$course = $this->coursem->find($id)->current();			if($course)			{				$course_id = $course->course_id;				$course_name = $course->course_name;				$course->delete();				$exams_in_course = $this->examm->in_course($course_id);				foreach($exams_in_course as $e)				{					$this->questionm->delete('exam_id = '.$e->exam_id); // Delete exam question					$this->examm->delete('exam_id = '.$e->exam_id); // Delete exam				}				// Delete student in course				$students_in_course = $this->studentm->in_course($course_id);				foreach($students_in_course as $s)				{					$this->userm->delete('id = '.$s->user_id);					$this->studentm->delete('student_id = '.$s->student_id);				}				$this->_alert->addMessage(array("message"=>'<i class="icon icon-trash"></i> Course "'.$course_name.'" deleted.', "status"=>"success"));			}		}		else		{			$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Incorrect course ID.', "status"=>"error"));		}		$this->_redirect('/course/list/');	}	public function editAction()	{		$id = $this->_request->getParam('id');		if($id)		{			$course = $this->coursem->find($id)->current();						if($course)			{			 	if($this->_request->isPost())		        {		        	if($this->coursef->isValid($_POST))		        	{			            $result = $this->coursem->edit($this->_request->getPost(), $course->course_id);			            if($result)			            {			                $this->_alert->addMessage(array("message"=>'<i class="icon icon-ok"></i>  Course updated.', "status"=>"success"));			                $this->_redirect("/course/edit/id/".$course->course_id);			            }		        	}		        }								$this->coursef->populate($course->toArray());				$this->view->form = $this->coursef;				$this->view->course = $course;			}			else			{				$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Invalid course ID.', "status"=>"error"));				$this->_redirect('/course/list/');			}		}		else		{			$this->_alert->addMessage(array("message"=>'<i class="icon icon-exclamation-sign"></i> Incorrect course ID.', "status"=>"error"));			$this->_redirect('/course/list/');		}	}}